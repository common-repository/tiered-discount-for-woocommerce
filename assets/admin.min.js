!function(i){const o=wp.hooks.applyFilters("tiered_discount_for_woocommerce_has_pro",!1);function r(e=66){var o=(new Date).getTime()+e,i="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random();return 0<o?(t=(o+t)%16|0,o=Math.floor(o/16)):(t=(i+t)%16|0,i=Math.floor(i/16)),("x"===e?t:3&t|8).toString(16)})}const e=wp.hooks.applyFilters("tiered_discount_for_woocommerce_condition_value",{value:"",weekly_days:[],logged_in:"yes",customer_users:[],billing_cities:"",shipping_cities:"",type:"cart:subtotal",operator:"less_than",billing_countries:[],shipping_countries:[]}),t=wp.hooks.applyFilters("tiered_discount_for_woocommerce_condition_extra_value",{hold_customers:[],loading_customers:!0});var s={template:"#component-tiered-discount",components:{"discount-condition":{template:"#component-tiered-discount-condition",props:{condition:{type:Object},number:{type:Number,default:0},ruleNo:{type:Number,default:0}},data(){return Object.assign({id:r(this.ruleNo),...e},this.condition,{...t})},beforeMount(){this.$parent.conditions[this.number]=this.$data},mounted(){this.pre_load_layout_data(),wp.hooks.doAction("tiered_discount_for_woocommerce_condition_mounted",this)},beforeUpdate(){i(this.$refs.select2_ajax).select2("destroy"),i(this.$refs.select2_dropdown).select2("destroy")},updated(){const o=this;i(this.$refs.select2_ajax).select2({placeholder:i(this).data("placeholder"),ajax:{url:tiered_discount_for_woocommerce_admin.ajax_url,dataType:"json",type:"POST",delay:500,data:function(e){let t=o.billing_state_country;return{country:t="shipping_states"==i(this).data("model")?o.shipping_state_country:t,term:e.term,type:i(this).data("type"),security:tiered_discount_for_woocommerce_admin.nonce,action:"tiered_discount_for_woocommerce/get_dropdown_data"}},processResults:function(e){return{results:i.map(e.data,function(e){return{text:e.name,id:e.id}})}}}}).on("change",function(){var e=i(this).data("model");e&&e.length&&(o[e]=i(this).val())}),i(this.$refs.select2_dropdown).select2({placeholder:i(this).data("placeholder")}).on("change",function(){var e=i(this).data("model");e&&e.length&&(o[e]=i(this).val())}),wp.hooks.doAction("tiered_discount_for_woocommerce_condition_updated",o)},watch:{type(){this.pre_load_layout_data()},...wp.hooks.applyFilters("tiered_discount_for_woocommerce_condition_watch",{})},methods:{get_countries(){return tiered_discount_for_woocommerce_admin.countries},get_ui_data_items(e){return Array.isArray(this[e])?this[e]:[]},delete_item(){confirm(tiered_discount_for_woocommerce_admin.i10n.delete_condition_warning)&&this.$parent.conditions.splice(this.number,1)},pre_load_layout_data(){const o=this;!function(){if("customer:users"===o.type){if(0==o.customer_users.length||!Array.isArray(o.customer_users))return o.loading_customers=!1;o.loading_customers=!0;const t=new FormData;o.customer_users.forEach(e=>{t.append("user_ids[]",e)}),t.append("type","users"),t.append("security",tiered_discount_for_woocommerce_admin.nonce),t.append("action","tiered_discount_for_woocommerce/get_dropdown_data"),fetch(tiered_discount_for_woocommerce_admin.ajax_url,{method:"POST",body:t}).then(e=>e.json()).then(e=>{1==e.success&&(o.loading_customers=!1,o.hold_customers=e.data)}).catch(e=>{})}}(),wp.hooks.doAction("tiered_discount_for_woocommerce_condition_preload",this)},...wp.hooks.applyFilters("tiered_discount_for_woocommerce_condition_methods",{})}}},props:{rule:{type:Object},ruleNo:{type:Number,default:0}},data(){return Object.assign({id:r(),discount:"",private_note:"",collapsed:!1,disabled:!1,discount_type:"fixed_discount",condition_relationship:"match_all",conditions:[],title:tiered_discount_for_woocommerce_admin.i10n.discount_tier+" "+(this.ruleNo+1)},this.rule)},beforeMount(){this.$root.$data.discount_tiers[this.ruleNo]=this.$data},beforeUpdate(){this.$root.$data.discount_tiers[this.ruleNo]=this.$data},computed:{is_free_shipping(){return this.$root.free_shipping}},methods:{duplicate_rule(e){if(3<=this.$root.discount_tiers.length&&!1===o)return this.$root.show_pro_notice();var e=JSON.parse(JSON.stringify(this.$root.discount_tiers[e])),t=e.title.length?e.title+" "+tiered_discount_for_woocommerce_admin.i10n.copy_text:"";this.$root.discount_tiers.push({...e,id:r(),title:t})},delete_rule(){confirm(tiered_discount_for_woocommerce_admin.i10n.delete_discount_tier_warning)&&this.$root.discount_tiers.splice(this.ruleNo,1)},move_up(){var e,t,o;0!=this.ruleNo&&(t=(e=this.$root.discount_tiers).splice(this.ruleNo,1)[0],o=this.ruleNo-1,e.splice(o,0,t))},move_down(){var e,t=this.$root.discount_tiers,o=this.ruleNo+1;o>=t.length||(e=t.splice(this.ruleNo,1)[0],t.splice(o,0,e))}}};const n=Vue.createApp({data(){return{discount_tiers:[],disabled:!1,start_after_date:"",free_shipping:!1,rule_import_coupon:null,show_locked_modal:!1,start_tiered_discount:"immediately",match_discount_tier_priority:"highest_discount"}},components:{"discount-tier-item":s},mounted(){const t=this;this.reuse_methods(),this.set_data(i("#tiered-discount-for-woocommerce").data("settings")),i(document).keyup(function(e){"Escape"===e.key&&(t.show_locked_modal=!1)})},updated(){this.reuse_methods()},computed:{get_json_data(){var e=JSON.parse(JSON.stringify(this.$data));delete e.free_shipping,delete e.rule_import_coupon,delete e.show_locked_modal;const o=Object.keys(t);return o.push("id"),e.discount_tiers.forEach(e=>{delete e.id,Array.isArray(e.conditions)&&e.conditions.map(t=>{o.forEach(e=>{delete t[e]})})}),JSON.stringify(e)},has_import_rule_id(){return 0<parseInt(this.rule_import_coupon)}},methods:{has_pro(){return o},set_data(e){if("object"==typeof e)for(const t in e)this[t]=e[t]},add_new_discount_tier(){if(3<=this.discount_tiers.length&&!1===o)return this.show_pro_notice();this.discount_tiers.push({})},import_coupon_data(){var e=new FormData;e.append("coupon_id",this.rule_import_coupon),e.append("security",this.$refs.import_nonce.value),e.append("action","tiered_discount_for_woocommerce/import_coupon_data"),fetch(tiered_discount_for_woocommerce_admin.ajax_url,{method:"POST",body:e}).then(e=>e.json()).then(e=>{this.set_data(e.data)})},show_pro_notice(){this.show_locked_modal=!0},reuse_methods(){const e=this;i(this.$refs.import_tiered_discount_rule).select2({placeholder:i(this).data("placeholder"),ajax:{url:tiered_discount_for_woocommerce_admin.ajax_url,dataType:"json",type:"POST",data:function(e){return{type:"coupon_rules",term:e.term,security:tiered_discount_for_woocommerce_admin.nonce,action:"tiered_discount_for_woocommerce/get_dropdown_data"}},processResults:function(e){return{results:i.map(e.data,function(e){return{text:e.name,id:e.id}})}}}}).on("change",function(){e.rule_import_coupon=i(this).val()})}}}).mount("#tiered-discount-for-woocommerce");i("#free_shipping").on("change",function(){n.free_shipping=i(this).is(":checked")}).trigger("change")}(jQuery);